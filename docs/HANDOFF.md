# HANDOFF（当前交接）

## 最后更新
- 日期：2026-02-07
- 维护目标：把 demo 变成可持续扩展的武侠世界框架

## 当前状态快照
- 地图：16 区域 / 71 地点 / 94 连线
- 角色：22 个 NPC
- 事件：20 个
- 敌人：13 个
- 新增系统：阵营声望、NPC 关系、任务状态、世界时间线

## 已完成
- 地图大扩展并保留旧 ID 兼容。
- NPC 扩展并加入阵营、关系种子、任务挂钩。
- 事件条件扩展（区域/标签/任务/关系/声望等）。
- 事件效果扩展（任务推进、关系与声望变化、世界时间线记录）。
- 增加世界数据一致性校验。
- 增加内容注册层 `src/content/index.js`，支持纵切片配置（`chapter_01`）。
- 抽出运行时服务层：`WorldStateService` / `QuestRuntime` / `DialogueRuntime`。
- 引入统一效果执行器 `effectApplier`，战斗与事件共享状态变更逻辑。
- 存档升级到 v2，并加入自动迁移逻辑（兼容 v1）。
- 新增可复现实验脚本 `scripts/simulate_world.mjs` 用于平衡性回归。

## 当前重点风险
- `GameScene` 仍偏大，后续新增系统会继续膨胀。
- 任务主干仍在 `events.js`，`QuestRuntime` 目前主要承担状态写入，尚未形成完整任务编排器。
- 对话分支目前还偏轻，尚未形成系统化剧情对话树。

## 下一步优先级（建议）
1. 拆 `GameScene` 渲染层：分离 Explore/Battle/UI Router。
2. 建立 `src/content/quests/` 与 `QuestCompiler`，把关键任务从 `events.js` 解耦。
3. 增加“势力态势日报”系统：按天改变世界事件权重。
4. 对话系统升级：支持基于关系/任务状态的多轮对话。

## 新 AI 接手时必须先做
1. 阅读 `docs/START_HERE.md` 和 `docs/WORKFLOW.md`。
2. 执行两条预检命令（scene import + worldValidation）。
3. 明确本轮目标并限制范围。

## 本轮若继续扩内容，建议选一个方向
- 方向 A：华山-开封-黑木主线增强
- 方向 B：大理-峨眉救援线增强
- 方向 C：少林-武当论武线增强

## 本文件更新要求
每次任务结束都追加：
- 做了什么
- 校验结果
- 剩余风险
- 下个 AI 的第一步建议
